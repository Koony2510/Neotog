name: Keep Repository Active

on:
  schedule:
    - cron: "0 10 1 * *"   # ë§¤ì›” 1ì¼ë§ˆë‹¤ ì‹¤í–‰ (UTC 10:00 â‰ˆ í•œêµ­ì‹œê°„ 19ì‹œì¯¤)
  workflow_dispatch:           # í•„ìš”í•  ë•Œ ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

permissions:
  contents: write              # GITHUB_TOKENìœ¼ë¡œ í‘¸ì‹œí•˜ê¸° ìœ„í•´ í•„ìš”

concurrency:
  group: keep-alive
  cancel-in-progress: false

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: âš™ï¸ Configure git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global --add safe.directory "$GITHUB_WORKSPACE"

      - name: ðŸ”Ž Detect default branch (auto-detect main/master)
        id: defbranch
        run: |
          DEFAULT_BRANCH=$(git symbolic-ref --quiet --short refs/remotes/origin/HEAD | sed 's|^origin/||')
          if [ -z "$DEFAULT_BRANCH" ]; then
            DEFAULT_BRANCH="${GITHUB_REF_NAME:-main}"
          fi
          echo "default-branch=$DEFAULT_BRANCH" >> "$GITHUB_OUTPUT"

      - name: âœï¸ Create dummy change
        run: |
          echo "Keep alive: $(date -u +'%Y-%m-%dT%H:%M:%SZ')" > .keepalive
          git add .keepalive
          git diff --cached --quiet && echo "No changes to commit" || git commit -m "chore: keep repo active"

      - name: ðŸ“¤ Push changes
        run: |
          git pull --rebase origin "${{ steps.defbranch.outputs.default-branch }}" || true
          if [ -n "$(git log origin/${{ steps.defbranch.outputs.default-branch }}..HEAD --oneline)" ]; then
            git push origin HEAD:${{ steps.defbranch.outputs.default-branch }}
          else
            echo "Nothing to push"
          fi
